<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Security · CRYPDEX</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;This page is not considered optional reading&lt;/strong&gt;.&lt;br/&gt;Docker leaves us in a funky security position and its important to patch it up.&lt;/p&gt;
&lt;/blockquote&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Security · CRYPDEX"/><meta property="og:type" content="website"/><meta property="og:url" content="https://crypdex.io/blackbox/"/><meta property="og:description" content="&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;This page is not considered optional reading&lt;/strong&gt;.&lt;br/&gt;Docker leaves us in a funky security position and its important to patch it up.&lt;/p&gt;
&lt;/blockquote&gt;
"/><meta property="og:image" content="https://crypdex.io/blackbox/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://crypdex.io/blackbox/img/docusaurus.png"/><link rel="shortcut icon" href="/blackbox/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/blackbox/css/main.css"/><script src="/blackbox/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/blackbox/"><img class="logo" src="/blackbox/img/logo.svg" alt="CRYPDEX"/><h2 class="headerTitleWithLogo">CRYPDEX</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/blackbox/docs/intro" target="_self">Docs</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Security</h1></header><article><div><span><blockquote>
<p><strong>This page is not considered optional reading</strong>.<br/>Docker leaves us in a funky security position and its important to patch it up.</p>
</blockquote>
<p>This document addresses Debian-based systems. If you have installed Blackbox on a non-Debian system, please seek out similar tools to restrict external access to ports exposed by Docker services. If you are running in a cloud deployment, you should use VPCs or similar network-level isolation.</p>
<h2><a class="anchor" aria-hidden="true" id="install-and-setup-a-firewall"></a><a href="#install-and-setup-a-firewall" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install and Setup a Firewall</h2>
<p>To secure the device, we <strong>must</strong> setup some firewall rules. We will do this with <code>ufw</code>.</p>
<pre><code class="hljs css language-shell">apt-get install ufw
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="define-policies"></a><a href="#define-policies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Define Policies</h3>
<p>To begin, we set some broad default access policies</p>
<pre><code class="hljs css language-shell">ufw default deny incoming
ufw default allow outgoing
</code></pre>
<p>Now, you may select the ports you would like open. The following are the defaults used by Crypdex - we open the SSH (<code>22</code>), API (<code>80</code>), mDNS (<code>5353</code>) , admin (<code>8888</code>) and Portainer (<code>9000</code>) ports, leaving the rest closed to outside access.</p>
<pre><code class="hljs css language-shell">ufw allow 22 80 8888 9000 5353
</code></pre>
<p>You will also notice that we closed off blockchain RPC access. If you feel comfortable opening this up, you may do so by adding the port (PIVX is <code>51473</code> and <code>51472</code>).</p>
<p>Finally, let's enable <code>ufw</code></p>
<pre><code class="hljs css language-shell">ufw enable
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="adjust-rules"></a><a href="#adjust-rules" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adjust Rules</h3>
<p>Without intervention, Docker and UFW do not play well together. In fact if left alone, the setup you did in the previous step will be completely ineffective.</p>
<p>Edit the following file</p>
<pre><code class="hljs css language-shell">nano /etc/ufw/after.rules
</code></pre>
<p>Append the following at the end</p>
<pre><code class="hljs css language-text"># Put Docker behind UFW
*filter
:DOCKER-USER - [0:0]
:ufw-user-input - [0:0]

-A DOCKER-USER -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A DOCKER-USER -m conntrack --ctstate INVALID -j DROP
-A DOCKER-USER -i eth0 -j ufw-user-input
-A DOCKER-USER -i eth0 -j DROP
COMMIT
</code></pre>
<p>This is the simple solution and it is not without trade offs. The one to be aware of is that it should only be done with Docker containers that map ports 1:1, that is, they are not remapped. This is the case with Blackbox. For more, see the links in the references section.</p>
<h3><a class="anchor" aria-hidden="true" id="reboot-and-test"></a><a href="#reboot-and-test" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reboot and Test</h3>
<p>Finally, <code>reboot</code> your device and do a quick port scan to assure that your setting are copacetic. YOu can use the Mac's Network Utility. <a href="https://itunes.apple.com/us/app/lanscan-pro/id562184107?mt=12">LanScan</a> for macOS is nice and has a duck face as a logo.</p>
<h3><a class="anchor" aria-hidden="true" id="references"></a><a href="#references" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>References</h3>
<p>Discussions on setting up UFW and similar with Docker are extensive. It is our opinion that Docker's default networking rules should be considered dangerous.</p>
<ul>
<li><a href="https://github.com/moby/moby/issues/4737#issuecomment-419705925">https://github.com/moby/moby/issues/4737#issuecomment-419705925</a></li>
<li><a href="https://gist.github.com/rubot/418ecbcef49425339528233b24654a7d">https://gist.github.com/rubot/418ecbcef49425339528233b24654a7d</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-18-04">https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-18-04</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="root-access-and-portainer"></a><a href="#root-access-and-portainer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Root access and Portainer</h2>
<p>All of this firewall preparation is for nothing if your root password is left as its default value (if you bought a device from Crypdex), or your Portainer password is weak.</p>
<h3><a class="anchor" aria-hidden="true" id="change-the-root-password"></a><a href="#change-the-root-password" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Change the root password</h3>
<p>Change your root password by ssh'ing into the device and running</p>
<pre><code class="hljs css language-shell">passwd
</code></pre>
<p>ez.</p>
<h3><a class="anchor" aria-hidden="true" id="portainer"></a><a href="#portainer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Portainer</h3>
<p>Portainer is sick. You should be able to access it at <a href="http://crypdex.local:9000">http://crypdex.local:9000</a>. Its database is uninitialized when first booted, so you must secure it with a password. Just visit its address and choose a password that is secure. And use a password manager if you can.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#install-and-setup-a-firewall">Install and Setup a Firewall</a><ul class="toc-headings"><li><a href="#define-policies">Define Policies</a></li><li><a href="#adjust-rules">Adjust Rules</a></li><li><a href="#reboot-and-test">Reboot and Test</a></li><li><a href="#references">References</a></li></ul></li><li><a href="#root-access-and-portainer">Root access and Portainer</a><ul class="toc-headings"><li><a href="#change-the-root-password">Change the root password</a></li><li><a href="#portainer">Portainer</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="https://crypdex.io" class="nav-home"><img src="/blackbox/img/logo-full-white.png" alt="CRYPDEX"/></a><div><h5>Community</h5><a href="https://discord.gg/TjmNPth">Discord</a><a href="https://www.instagram.com/crypdex_io/" target="_blank" rel="noreferrer noopener">Instagram</a></div><div><h5>More</h5><a href="https://medium.com/crypdex" target="_blank" rel="noreferrer noopener">Medium</a><a href="https://github.com/crypdex/blackbox">GitHub</a><a class="github-button" href="https://github.com/crypdex/blackbox" data-icon="octicon-star" data-count-href="/crypdex/blackbox/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 Crypdex</section></footer></div></body></html>