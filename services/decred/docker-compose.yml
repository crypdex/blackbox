version: '3.7'

# Since these services use certs to validate connections,
# user/pass combinations *should be* optional

# DECRED_DATA_DIR (autogenerated)
# DECRED_RPCUSER
# DECRED_RPCPASS
# DECRED_WALLET_PASS

services:
  decred:
    build: .
    container_name: decred
  dcrd:
    image: crypdex/decred:1.4
    restart: on-failure
    container_name: dcrd
    volumes:
      - ${DECRED_DATA_DIR:?DECRED_DATA_DIR required}/dcrd:/home/decred/.dcrd
      - ${DECRED_DATA_DIR:?DECRED_DATA_DIR required}/dcrwallet:/home/decred/.dcrwallet
    environment:
      NETWORK: ${DECRED_NETWORK:-mainnet}
      RPCUSER: ${DECRED_RPCUSER:?DECRED_RPCPASS is required}
      RPCPASS: ${DECRED_RPCPASS:?DECRED_RPCPASS is required}
    command: dcrd
      ${DECRED_DCRD_FLAGS:-}

  dcrwallet:
    image: crypdex/decred:1.4
    restart: on-failure
    container_name: dcrwallet
    volumes:
      - ${DECRED_DATA_DIR:?DECRED_DATA_DIR required}/dcrd:/home/decred/.dcrd
      - ${DECRED_DATA_DIR:?DECRED_DATA_DIR required}/dcrwallet:/home/decred/.dcrwallet
    environment:
      NETWORK: ${DECRED_NETWORK:-mainnet}
      RPCUSER: ${DECRED_RPCUSER:?DECRED_RPCPASS is required}
      RPCPASS: ${DECRED_RPCPASS:?DECRED_RPCPASS is required}
    # --pass= should be set in the .conf file!
    command: dcrwallet
      --rpcconnect=dcrd
      --pass=${DECRED_WALLET_PASS}
      ${DECRED_DCRWALLET_FLAGS:-}
